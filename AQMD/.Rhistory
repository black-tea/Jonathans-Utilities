mutate(start_time = as.POSIXct(strftime(start,
format = "%H:%M:%S",
tz = "America/Los_Angeles"),
format = "%H:%M:%S"),
end_time = as.POSIXct(strftime(end,
format = "%H:%M:%S",
tz = "America/Los_Angeles"),
format = "%H:%M:%S"),
duration = end_time - start_time,
wday = wday(start, week_start = 1))
# Function for processing an activity on a minute-by-minute basis; active = 1, not active = 0
compute_day_curve <- function(df_row) {
start <- as.numeric(ridge_data[df_row, "start_time"])
end <- as.numeric(ridge_data[df_row, "end_time"])
wday <- as.character(ridge_data[df_row, "wday"])
result <- data.frame(time = seq(as.POSIXct("00:00:00",
format = "%H:%M:%S",
tz = "America/Los_Angeles"),
as.POSIXct("23:59:58",
format = "%H:%M:%S",
tz = "America/Los_Angeles"),
by = 60)) %>%
mutate(time_end = lead(time,
default = as.POSIXct("23:59:59",
format = "%H:%M:%S")),
active = ifelse(time > start & time_end < end, 1, 0), wday = wday)
result
}
# Process all activities
plot_data <- 1:nrow(ridge_data) %>%
map_df(~compute_day_curve(.x), .id = "id") %>%
filter(!is.na(active), active > 0) %>%
mutate(wday = as.factor(wday))
plot_data$wday <- factor(plot_data$wday, levels = rev(levels(plot_data$wday)))
# Create plot
ridges <- ggplot() +
geom_density_ridges(aes(x = time, y = wday), plot_data, size = 0.5) +
theme_ridges() +
scale_y_discrete(expand = c(0.01, 0), labels = c("Sun", "Sat", "Fri", "Thu", "Wed", "Tue", "Mon")) +
scale_x_datetime(expand = c(0, 0), date_labels = "%I:%M %p") +
theme(panel.grid = element_blank(), plot.margin = unit(rep(1, 4), "cm")) +
xlab(NULL) + ylab(NULL)
# Save plot
ggsave("ridges001.png", ridges, width = 24, height = 20, units = "cm")
plot(cars)
setwd("~/GitHub/Jonathans-Utilities/AQMD")
# load libraries
library(sf)
library(dplyr)
library(leaflet)
# import street data
bss <- st_read("Data/Street_Pavement_Condition.shp")
# load libraries
library(sf)
library(dplyr)
library(leaflet)
# import street data
bss <- st_read("Data/Street_Pavement_Condition.shp")
rm(list=ls())
# load libraries
library(sf)
library(dplyr)
library(leaflet)
# import street data
bss <- st_read("Data/Street_Pavement_Condition.shp")
glimpse(bss)
bss <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH
)
View(bss)
View(bss)
bss <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH
) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II'
))
bss <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH
) %>%
dplyr::filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II'
))
bss <- bss %>% filter(STREET_DES %in% c('Divided Major Highway - Class II'))
# load libraries
library(sf)
library(dplyr)
library(leaflet)
# import street data
bss <- st_read("Data/Street_Pavement_Condition.shp")
bss <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH
) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II'
)
)
bss <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II')) %>%
group_by('NAME')
print(bss)
# load libraries
library(sf)
library(dplyr)
library(leaflet)
# import street data
bss <- st_read("Data/Street_Pavement_Condition.shp")
bss <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II')) %>%
group_by(NAME)
print(bss)
bss <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II')) %>%
group_by(NAME) %>%
as_tibble()
#print(bss)
# load libraries
library(sf)
library(dplyr)
library(leaflet)
# import street data
bss <- st_read("Data/Street_Pavement_Condition.shp")
bss <- bss %>%
st_intersects()
bss
# load libraries
library(sf)
library(dplyr)
library(leaflet)
# import street data
bss <- st_read("Data/Street_Pavement_Condition.shp")
corridors <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II')) %>%
group_by(NAME) %>%
st_join()
corridors <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II')) %>%
group_by(NAME) %>%
st_touches()
plot(corridors)
corridors <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II')) %>%
group_by(NAME) %>%
st_touches()
plot(st_geometry(corridors))
# load libraries
library(sf)
library(dplyr)
library(leaflet)
# import street data
bss <- st_read("Data/Street_Pavement_Condition.shp")
corridors <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II')) %>%
group_by(NAME) %>%
st_touches()
plot(st_geometry(corridors))
View(corridors)
bss_filtered <- bss %>%
filter(FID %in% c(13460, 15512, 31502, 65716, 68201))
plot(st_geometry(bss_filtered))
bss_filtered <- bss %>%
filter(FID %in% c(589,1169,3313,4558))
plot(st_geometry(bss_filtered))
bss_filtered <- bss %>%
filter(FID %in% c(6600,7250))
plot(st_geometry(bss_filtered))
corridors <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II')) %>%
#group_by(NAME) %>%
#st_touches()
plot(st_geometry(corridors))
corridors <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II')) #%>%
#group_by(NAME) %>%
#st_touches()
plot(st_geometry(corridors))
corridors <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II')) #%>%
group_by(NAME) %>%
st_touches()
corridors <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II')) %>%
group_by(NAME) %>%
st_touches()
plot(st_geometry(corridors))
View(corridors)
corridors2 <- corridors[[1]]
corridors <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II')) %>%
group_by(NAME) #%>%
#st_touches()
#corridors2 <- corridors[[1]]
#plot(st_geometry(corridors))
View(corridors)
corridors <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II')) %>%
group_by(NAME) %>%
st_touches() %>%
st_union()
'Divided Major Highway - Class II',
# load libraries
library(sf)
library(dplyr)
library(leaflet)
# import street data
bss <- st_read("Data/Street_Pavement_Condition.shp")
corridors <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II')) %>%
group_by(NAME) %>%
st_touches() #%>%
#st_union()
#corridors2 <- corridors[[1]]
#plot(st_geometry(corridors))
corridors <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II')) %>%
group_by(NAME) %>%
#st_touches() #%>%
st_union()
#corridors2 <- corridors[[1]]
#plot(st_geometry(corridors))
corridors <- bss %>%
select(
SECT_ID,
STREET_DES,
NAME,
FROM_,
TO_,
ZLENGTH) %>%
filter(STREET_DES %in% c(
'Divided Major Highway - Class II',
'Major Highway - Class I',
'Major Highway - Class II',
'Modified Major Highway',
'Scenic Major Highway - Class I',
'Scenic Major Highway - Class II',
'Und. or Prop. Major Hwy - Class II',
'Und. or Prop. Scenic Major Highway - Class II')) %>%
group_by(NAME) %>%
#st_touches() #%>%
st_union()
#corridors2 <- corridors[[1]]
plot(st_geometry(corridors))
